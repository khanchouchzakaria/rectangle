
<!DOCTYPE html>
<html>
<head>
    <title>Rectangle Area – Student 220504544</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.min.js"></script>
</head>
<body>

<h2>Rectangle Area DApp – Student 220504544</h2>

<button onclick="connectWallet()">Connect Wallet</button>
<p id="account"></p>
<hr>

<!-- Width Input -->
<input type="number" id="widthInput" placeholder="Enter width" />
<button onclick="setWidth()">Set Width 220504544</button>
<br><br>

<!-- Height Input -->
<input type="number" id="heightInput" placeholder="Enter height" />
<button onclick="setHeight()">Set Height 220504544</button>
<br><br>

<!-- Get Area -->
<button onclick="getArea()">Area 220504544</button>

<p id="output"></p>
<p id="error" style="color:red;"></p>

<script>
// -------------------------
// Contract Information
// -------------------------
const contractAddress = "0x388e7eca4902D821eD172595A948e4Cc87A8472b";

const abi = [
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "h",
                "type": "uint256"
            }
        ],
        "name": "setHeight",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "w",
                "type": "uint256"
            }
        ],
        "name": "setWidth",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "area",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "getHeight",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "getWidth",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    }
];

let provider;
let signer;
let contract;

// -------------------------
// Connect Wallet (MetaMask)
// -------------------------
async function connectWallet() {
    try {
        if (!window.ethereum) {
            alert("Please install MetaMask first.");
            return;
        }

        // ask MetaMask for accounts
        await window.ethereum.request({ method: "eth_requestAccounts" });

        provider = new ethers.BrowserProvider(window.ethereum);
        signer = await provider.getSigner();
        contract = new ethers.Contract(contractAddress, abi, signer);

        const addr = await signer.getAddress();
        document.getElementById("account").innerText = "Connected: " + addr;
        document.getElementById("error").innerText = "";
        console.log("Connected:", addr);
    } catch (err) {
        console.error(err);
        document.getElementById("error").innerText = "Error connecting wallet: " + err.message;
    }
}

async function getContract() {
    if (!contract) {
        await connectWallet();
    }
    return contract;
}

// -------------------------
// Write: Set Width
// -------------------------
async function setWidth() {
    document.getElementById("error").innerText = "";
    try {
        const width = document.getElementById("widthInput").value;
        if (!width || width <= 0) {
            document.getElementById("error").innerText = "Width must be greater than 0.";
            return;
        }

        const c = await getContract();
        const tx = await c.setWidth(width);
        document.getElementById("output").innerText = "Sending tx to set width...";
        console.log("setWidth tx:", tx.hash);
        await tx.wait();
        document.getElementById("output").innerText = "Width set to: " + width;
    } catch (err) {
        console.error(err);
        document.getElementById("error").innerText = "Error setting width: " + err.message;
    }
}

// -------------------------
// Write: Set Height
// -------------------------
async function setHeight() {
    document.getElementById("error").innerText = "";
    try {
        const height = document.getElementById("heightInput").value;
        if (!height || height <= 0) {
            document.getElementById("error").innerText = "Height must be greater than 0.";
            return;
        }

        const c = await getContract();
        const tx = await c.setHeight(height);
        document.getElementById("output").innerText = "Sending tx to set height...";
        console.log("setHeight tx:", tx.hash);
        await tx.wait();
        document.getElementById("output").innerText = "Height set to: " + height;
    } catch (err) {
        console.error(err);
        document.getElementById("error").innerText = "Error setting height: " + err.message;
    }
}

// -------------------------
// Read: Compute Area
// -------------------------
async function getArea() {
    document.getElementById("error").innerText = "";
    try {
        const c = await getContract();
        const width = await c.getWidth();
        const height = await c.getHeight();
        const area = await c.area();

        document.getElementById("output").innerHTML =
            "Width: " + width +
            "<br>Height: " + height +
            "<br><b>Area: " + area + "</b>";
    } catch (err) {
        console.error(err);
        document.getElementById("error").innerText = "Error getting area: " + err.message;
    }
}
</script>
</body>
</html>

