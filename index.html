<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RectangleArea DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 40px;
    }
    input {
      padding: 8px;
      margin: 5px;
      width: 200px;
    }
    button {
      padding: 8px 16px;
      margin: 5px;
      cursor: pointer;
    }
    .section {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>üìê RectangleArea DApp</h2>
  <p>Set width & height, then calculate area on-chain</p>

  <!-- Connect -->
  <button id="connectBtn" onclick="connectWallet()">üîó Connect MetaMask</button>
  <p id="wallet">Not connected</p>

  <hr />

  <!-- Width -->
  <div class="section">
    <h3>Set Width</h3>
    <input id="widthInput" type="number" min="1" placeholder="Enter width (integer)" />
    <button onclick="setWidthValue()">Set Width</button>
    <br />
    <button onclick="readWidth()">Get Width</button>
    <p id="widthDisplay">Width: -</p>
  </div>

  <!-- Height -->
  <div class="section">
    <h3>Set Height</h3>
    <input id="heightInput" type="number" min="1" placeholder="Enter height (integer)" />
    <button onclick="setHeightValue()">Set Height</button>
    <br />
    <button onclick="readHeight()">Get Height</button>
    <p id="heightDisplay">Height: -</p>
  </div>

  <!-- Area -->
  <div class="section">
    <h3>Area</h3>
    <button onclick="readArea()">Get Area</button>
    <p id="areaDisplay">Area: -</p>
  </div>

  <script>
    // ---------- CONTRACT DETAILS ----------
    const contractAddress = "0x388e7eca4902D821eD172595A948e4Cc87A8472b";

    const contractABI = [
      {
        "inputs": [
          { "internalType": "uint256", "name": "h", "type": "uint256" }
        ],
        "name": "setHeight",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "uint256", "name": "w", "type": "uint256" }
        ],
        "name": "setWidth",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "area",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getHeight",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getWidth",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    // ---------- GLOBALS ----------
    let provider;
    let signer;
    let contract;

    // ---------- CONNECT METAMASK ----------
    async function connectWallet() {
      if (!window.ethereum) {
        alert("Please install MetaMask!");
        return;
      }

      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });

        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        contract = new ethers.Contract(contractAddress, contractABI, signer);

        const address = await signer.getAddress();
        document.getElementById("wallet").innerText = "Connected: " + address;

        const btn = document.getElementById("connectBtn");
        btn.innerText = "‚úÖ Connected";
        btn.disabled = true;
      } catch (err) {
        console.error(err);
        alert("Connection failed: " + (err.message || err));
      }
    }

    // ---------- SET WIDTH ----------
    async function setWidthValue() {
      if (!contract) {
        alert("Connect MetaMask first.");
        return;
      }

      const w = document.getElementById("widthInput").value;
      if (!w || Number(w) <= 0) {
        alert("Enter a width greater than 0.");
        return;
      }

      try {
        const tx = await contract.setWidth(w);
        await tx.wait();
        alert("Width set to " + w);
        await readWidth();
      } catch (err) {
        console.error(err);
        alert("setWidth failed: " + (err.data?.message || err.message || err));
      }
    }

    // ---------- SET HEIGHT ----------
    async function setHeightValue() {
      if (!contract) {
        alert("Connect MetaMask first.");
        return;
      }

      const h = document.getElementById("heightInput").value;
      if (!h || Number(h) <= 0) {
        alert("Enter a height greater than 0.");
        return;
      }

      try {
        const tx = await contract.setHeight(h);
        await tx.wait();
        alert("Height set to " + h);
        await readHeight();
      } catch (err) {
        console.error(err);
        alert("setHeight failed: " + (err.data?.message || err.message || err));
      }
    }

    // ---------- READ WIDTH ----------
    async function readWidth() {
      if (!contract) {
        alert("Connect MetaMask first.");
        return;
      }

      try {
        const w = await contract.getWidth();
        document.getElementById("widthDisplay").innerText = "Width: " + w.toString();
      } catch (err) {
        console.error(err);
        alert("Error reading width: " + (err.message || err));
      }
    }

    // ---------- READ HEIGHT ----------
    async function readHeight() {
      if (!contract) {
        alert("Connect MetaMask first.");
        return;
      }

      try {
        const h = await contract.getHeight();
        document.getElementById("heightDisplay").innerText = "Height: " + h.toString();
      } catch (err) {
        console.error(err);
        alert("Error reading height: " + (err.message || err));
      }
    }

    // ---------- READ AREA ----------
    async function readArea() {
      if (!contract) {
        alert("Connect MetaMask first.");
        return;
      }

      try {
        const a = await contract.area();
        document.getElementById("areaDisplay").innerText = "Area: " + a.toString();
      } catch (err) {
        console.error(err);
        // If width or height not set, contract will revert with require
        alert("Error reading area (did you set width & height?): " + (err.data?.message || err.message || err));
      }
    }
  </script>
</body>
</html>

